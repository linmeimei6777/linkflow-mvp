<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>电子签署 · LinkFlow</title>

    <!-- iOS PWA 相关优化 -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="LinkFlow 签署" />

    <!-- 主题颜色 -->
    <meta name="theme-color" content="#334155" />

    <!-- 禁止缓存，避免老版本签名板残留 -->
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <style>
      :root {
        --bg-light: #f8fafc;
        --bg-mid: #dbeafe;
        --bg-dark: #334155;

        --panel-bg: rgba(15, 23, 42, 0.6); /* 主卡片背景 */
        --panel-border: #334155;
        --panel-radius: 20px;

        --text-main: #f8fafc;
        --text-dim: #94a3b8;

        --accent-start: #4f46e5;
        --accent-end: #1e1e2e;
        --accent-border: #6366f1;
      }

      * {
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }

      body {
        margin: 0;

        background: -webkit-linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-mid) 40%,
          var(--bg-dark) 100%
        ) !important;
        background: linear-gradient(
          135deg,
          var(--bg-light) 0%,
          var(--bg-mid) 40%,
          var(--bg-dark) 100%
        ) !important;
        background-attachment: fixed;
        background-size: cover;

        color: var(--text-main);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

        min-height: 100vh;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 24px 16px 80px;
      }

      .page {
        width: 100%;
        max-width: 480px;
        display: grid;
        gap: 20px;
      }

      /* 顶部合同行信息卡 */
      .doc-card {
        background-color: var(--panel-bg);
        border: 1px solid var(--panel-border);
        border-radius: var(--panel-radius);
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.6);
        padding: 20px 20px 16px;
      }

      .doc-headline {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 12px;
      }

      .doc-icon {
        width: 48px;
        height: 48px;
        border-radius: 14px;
        background: radial-gradient(
          circle at 30% 30%,
          var(--accent-start) 0%,
          var(--accent-end) 70%
        );
        border: 1px solid var(--accent-border);
        box-shadow: 0 20px 40px rgba(59, 130, 246, 0.35);

        font-size: 16px;
        font-weight: 600;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .doc-title-block {
        flex: 1;
      }

      .doc-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-main);
        line-height: 1.4;
      }

      .doc-meta {
        font-size: 13px;
        color: var(--text-dim);
        line-height: 1.4;
        margin-top: 4px;
      }

      /* 签名卡片 */
      .sign-card {
        background-color: var(--panel-bg);
        border: 1px solid var(--panel-border);
        border-radius: var(--panel-radius);
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.6);
        padding: 20px;
      }

      .sign-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .sign-labels {
        display: grid;
        gap: 4px;
      }

      .sign-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--text-main);
        line-height: 1.4;
      }

      .sign-desc {
        font-size: 12px;
        line-height: 1.4;
        color: var(--text-dim);
      }

      .clear-btn {
        background: transparent;
        border: 1px solid var(--panel-border);
        border-radius: 10px;
        padding: 6px 10px;
        font-size: 12px;
        color: var(--text-dim);
        line-height: 1.2;
      }

      /* 签名板区域 */
      .sign-box {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 12px;
        box-shadow: inset 0 0 16px rgba(0, 0, 0, 0.6);
        padding: 12px;
      }

      .canvas-wrapper {
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        touch-action: none; /* 禁止手指拖动页面而不是写字 */
      }

      canvas {
        width: 100%;
        height: 160px;
        display: block;
        background: #fff;
      }

      .sign-hint {
        font-size: 11px;
        line-height: 1.5;
        color: var(--text-dim);
        text-align: right;
        margin-top: 8px;
      }

      /* 底部确认按钮 */
      .actions {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        padding: 16px;
        display: flex;
        justify-content: center;
        pointer-events: none; /* 容器不挡点击，只让按钮可点 */
      }

      .confirm-btn {
        pointer-events: auto;
        min-width: 200px;
        background: radial-gradient(
          circle at 30% 30%,
          var(--accent-start) 0%,
          var(--accent-end) 70%
        );
        box-shadow: 0 20px 40px rgba(59, 130, 246, 0.35);

        border: 1px solid var(--accent-border);
        border-radius: 14px;

        color: #fff;
        font-size: 16px;
        font-weight: 600;
        line-height: 1.2;
        padding: 14px 16px;
        text-align: center;
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 80px;
        transform: translateX(-50%);
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid #334155;
        border-radius: 12px;
        color: var(--text-main);
        font-size: 14px;
        font-weight: 500;
        line-height: 1.4;
        padding: 12px 16px;
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.9);
        display: none;
        max-width: 80%;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div class="page">
      <!-- 合同信息 -->
      <section class="doc-card">
        <div class="doc-headline">
          <div class="doc-icon">合同</div>

          <div class="doc-title-block">
            <div class="doc-title" id="docTitle">
              《合作服务协议》v1.0
            </div>
            <div class="doc-meta" id="docMeta">
              甲方：盛华科技有限公司<br />
              乙方：张三（手机尾号 8890）
            </div>
          </div>
        </div>

        <div class="doc-meta" style="font-size:12px; line-height:1.5;">
          请确认您是乙方本人，并即将对本合同进行手写签署。
        </div>
      </section>

      <!-- 签名区域 -->
      <section class="sign-card">
        <div class="sign-header">
          <div class="sign-labels">
            <div class="sign-title">手写签名 / 签字</div>
            <div class="sign-desc">
              请直接在下面空白区域用手指书写您的签名
            </div>
          </div>

          <button class="clear-btn" id="clearBtn">清除重写</button>
        </div>

        <div class="sign-box">
          <div class="canvas-wrapper">
            <canvas id="signPad"></canvas>
          </div>
          <div class="sign-hint">提示：保持字迹清晰完整</div>
        </div>
      </section>
    </div>

    <!-- 固定在底部的确认按钮 -->
    <div class="actions">
      <div class="confirm-btn" id="confirmBtn">确认签名并提交</div>
    </div>

    <!-- Toast 提示 -->
    <div class="toast" id="toast">签名已提交（模拟）</div>

    <script>
      const canvas = document.getElementById("signPad");
      const ctx = canvas.getContext("2d");
      const clearBtn = document.getElementById("clearBtn");
      const confirmBtn = document.getElementById("confirmBtn");
      const toast = document.getElementById("toast");

      // 让画布在高清屏下仍然清晰
      function resizeCanvas() {
        const ratio = window.devicePixelRatio || 1;
        const displayWidth = canvas.clientWidth;
        const displayHeight = canvas.clientHeight;

        canvas.width = displayWidth * ratio;
        canvas.height = displayHeight * ratio;

        ctx.scale(ratio, ratio);
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.strokeStyle = "#000";
      }

      resizeCanvas();
      window.addEventListener("resize", resizeCanvas);

      let drawing = false;
      let lastX = 0;
      let lastY = 0;

      function startDraw(x, y) {
        drawing = true;
        lastX = x;
        lastY = y;
      }

      function drawLine(x, y) {
        if (!drawing) return;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
        lastX = x;
        lastY = y;
      }

      function endDraw() {
        drawing = false;
      }

      // 触摸（手机上手指写字）
      canvas.addEventListener(
        "touchstart",
        (e) => {
          const rect = canvas.getBoundingClientRect();
          const t = e.touches[0];
          startDraw(t.clientX - rect.left, t.clientY - rect.top);
          e.preventDefault();
        },
        { passive: false }
      );

      canvas.addEventListener(
        "touchmove",
        (e) => {
          const rect = canvas.getBoundingClientRect();
          const t = e.touches[0];
          drawLine(t.clientX - rect.left, t.clientY - rect.top);
          e.preventDefault();
        },
        { passive: false }
      );

      canvas.addEventListener(
        "touchend",
        () => {
          endDraw();
        },
        { passive: false }
      );

      // 鼠标（电脑上测试也能画）
      canvas.addEventListener("mousedown", (e) => {
        const rect = canvas.getBoundingClientRect();
        startDraw(e.clientX - rect.left, e.clientY - rect.top);
      });
      canvas.addEventListener("mousemove", (e) => {
        const rect = canvas.getBoundingClientRect();
        drawLine(e.clientX - rect.left, e.clientY - rect.top);
      });
      canvas.addEventListener("mouseup", endDraw);
      canvas.addEventListener("mouseleave", endDraw);

      // 清除
      clearBtn.addEventListener("click", () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      });

      // 提交（目前只是弹提示。后面可以把画布导出成图片上传）
      confirmBtn.addEventListener("click", () => {
        // const dataURL = canvas.toDataURL("image/png");
        showToast("签名已提交（模拟）");
      });

      function showToast(msg) {
        toast.textContent = msg;
        toast.style.display = "block";
        toast.style.opacity = "1";

        setTimeout(() => {
          toast.style.transition = "opacity 0.4s";
          toast.style.opacity = "0";
          setTimeout(() => {
            toast.style.display = "none";
            toast.style.transition = "";
          }, 400);
        }, 1500);
      }
    </script>
  </body>
</html>
